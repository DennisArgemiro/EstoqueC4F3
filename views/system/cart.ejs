<%- include('./partials/header'); %>

<div class="card col-12 mt-4">
  
  <div class="card-header">
    <h1 class="card-title col-12"><i class="fa-solid fa-cart-shopping mr-2"></i> Carrinho de compra <span class="text-right float-right my-0">produtos: <b><%= cartItems.count %></b></span></h1>
  </div>

  <div class="card-body col-12 p-0">

    <div class="row">

      <div class="col-12 m-0 p-0" style="border-bottom: 10px solid black;">

        <form class="m-0" id="filterTwo">

          <div class="input-group ">
            <input style="border-radius: 0;" type="text" class="form-control" id="text" placeholder="Digite o contedo da pesquisa." aria-label="Digite o conteúdo da pesquisa." aria-describedby="basic-addon2">
            <div class="input-group-append">
              <button style="border-radius: 0;" class="btn btn-outline-secondary" type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
            </div>
          </div>
  
          <label class="mt-4 ml-3">Tipo</label>
          <select class="form-control mb-0" id="type" style="border-radius: 0;">
            <option value="name">nome</option>
            <option value="type">tipo</option>
            <option value="price">preço</option>
            <option value="validity">validade</option>
            <option value="lote">lote</option>
            <option value="qtd">quantidade</option>
          </select>
  
        </form>

      </div>

      <div class="col-6 m-0 p-0" style="border-right: 1px solid black;">
      

        <div id="result"></div>
      
      </div>



      <div class="col-6 p-0 m-0 float-right">

        <table class="table">
          <% let counter = 1 %>

          <tr class="tableHeader">
            <th>#</th>
            <th>nome</th>
            <th>qtd</th>
            <th>unitário</th>
            <th>total</th>
            <th>Remover</th>
          </tr>
          
          
          
          
          <% cartItems.rows.forEach((productId) => { %>

            <tr class="tableRow">
              
              <td><%= counter %></td>
              <td>

                <% products.forEach((product) => { %>

                  <% if (product.id == productId.product) { %>

                    <%= product.name %>

                  <% } %>

                <% }) %>

              </td>
              <td><%= productId.qtd%></td>
              <td>

                <% products.forEach((product) => { %>

                  <% if (product.id == productId.product) { %>

                    R$<%= product.price %>

                  <% } %>

                <% }) %>

              </td>
              <td>

                <% products.forEach((product) => { %>

                  <% if (product.id == productId.product) { %>

                    R$<%= product.price * productId.qtd %>

                  <% } %>

                <% }) %>

              </td>

              <td>

                <center><form method="POST" action="/remove/<%= productId.id %>"><button type="submit" class="btn btn-danger"><i class="fa-solid fa-trash"></i></button></form></center>

              </td>
            
            </tr>

            <% counter++ %>

          <% }); %>

         
      
        

        </table>

      </div>

    </div>

  </div>

  <div class="card-footer">
    
    <button type="button" class="btn btn-primary col-12" data-toggle="modal" data-target="#checkoutModal">Checkout</button>

  </div>

</div>

<!-- Large Modal -->
<div class="modal fade" id="checkoutModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title"><i class="fa-solid fa-cash-register mr-2"></i> Checkout</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        

        <form class="form" method="POST" action="/checkout">

          <label for="cpf">CPF</label>
          <input name="cpf" type="text" class="form-control" id="cpf" placeholder="000.000.000-00">

          <label for="payment" class="mt-2">Forma de Pagamento *</label>
          <select name="payment" class="form-control" required  id="payment">

            <option value="0" selected>Escolha uma forma de pagamento</option>
            <option value="Débito/Crédito">Débito/Crédito</option>
            <option value="Dinheiro">Dinheiro</option>
            <option value="Pix">Pix</option>

          </select>

          <div id="cardOpt" class="mt-2" hidden>

            <label for="cardLabel">Bandeira *</label>
            <select class="form-control" name="complement" required id="cardLabel">

              <option>Mastercard</option>
              <option>Elo</option>
              <option>Visa</option>
              <option>Cartão Clonado</option>

            </select>

          </div>

          <div id="moneyOpt" class="mt-2" hidden>

            <label for="moneyRecived">Valor pago *</label>
            <input required type="number" name="complement" class="form-control" id="moneyRecived" value="0" placeholder="100,00">

          </div>

          <div id="pixOpt" class="mt-2" hidden>

            <input type="text" name="complement" value="-" hidden>
            <center><img src="data:image/png;base64,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"></center>

          </div>


          <% let tot = 0; %>

          <% cartItems.rows.forEach((itm) => { %>

            <% products.forEach((pdrct) => { %>

              <% if (pdrct.id == itm.product) { %>

                <% tot = tot + Number(pdrct.price) * Number(itm.qtd) %>

              <% } %>

            <% }); %>

          <% }); %>

          <div id="resultModal">

            <hr>

            <div style="display: flex; justify-content: space-between;">
            
            <h4 hidden id="trocoLabel">Troco: <b>R$<span id="trocoValue">00,00</span></b> </h4>
            <h4 id="total">Total: <b>R$ <span id="totall"><%= tot.toString().replace('.', ','); %></span></b></h4>

            </div>

          </div>

          <input type="text" id="totalInput" name="totalInput" value="<%= tot %>" hidden>
          <button type="submit" class="btn btn-success col-12 mt-3"><i class="fa-solid fa-cash-register mr-2"></i> Checkout</button>

        </form>


      </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
</div>
<!-- /.modal -->
<script src="./js/filterTwo.js"></script>
<script src="./js/payment.js"></script>

<%- include('./partials/footer'); %>
